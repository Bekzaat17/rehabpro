{% extends "base.html" %}
{% load static %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}

{% block content %}
<div class="container mt-5">
  <h1 class="mb-4">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ä–µ–∑–∏–¥–µ–Ω—Ç—É</h1>

  <!-- üîé –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
  <form id="filter-form" class="row g-3 mb-4">
    <div class="col-md-4">
      <label for="resident" class="form-label">–†–µ–∑–∏–¥–µ–Ω—Ç</label>
      <select id="resident" name="resident_id" class="form-select">
        {% for resident in residents %}
          <option value="{{ resident.id }}">{{ resident.full_name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label for="date_from" class="form-label">–° –¥–∞—Ç—ã</label>
      <input type="date" id="date_from" name="date_from" class="form-control" />
    </div>
    <div class="col-md-3">
      <label for="date_to" class="form-label">–ü–æ –¥–∞—Ç—É</label>
      <input type="date" id="date_to" name="date_to" class="form-control" />
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-primary w-100">–ü–æ–∫–∞–∑–∞—Ç—å</button>
    </div>
  </form>

  <div class="text-end mb-3">
    <button id="export-button" class="btn btn-outline-secondary" disabled>üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
  </div>

  <!-- üìÑ –í—Å—ë, —á—Ç–æ –ø–æ–π–¥—ë—Ç –≤ PDF -->
  <div id="pdf-wrapper">
    <div id="analytics-results" class="row gy-4">
      <p class="text-muted">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–∫–∞–∑–∞—Ç—å", —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É.</p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
  .analytics-block {
    max-width: 900px;
    margin: 0 auto;
    page-break-inside: avoid;
    break-inside: avoid;
  }

  .chart-wrapper {
    position: relative;
    height: 350px;
    width: 100%;
  }

  @media (max-width: 768px) {
    .chart-wrapper {
      height: 300px;
    }
  }

  canvas {
    display: block;
    width: 100% !important;
    height: 100% !important;
  }

  .page-break {
    page-break-after: always;
    break-after: always;
  }
</style>

<script src="{% static 'js/analytics/full_page.js' %}"></script>
{% endblock %}